"
" .vimperatorrc
"
" vimperator v3.5
"

" runtimepath
set runtimepath=~/.vimperator

" オプション設定 {{{1
"
" disable beep
set visualbell
highlight Bell display:none

" タイトルの変更
set titlestring=Firefox
" スクロールバー表示
set scrollbars=true
" ツールバー表示
set toolbars=all
" タブ番号を非表示
set notabnumbers

" ページロード時にテキストボックスにフォーカスするのを防ぐ
set focuscontent

" ヒントの見出し(label)に利用する文字の指定
set hintchars=hjkluioynm

" 検索語のハイライト
set hlsearch

" :[tab]open時の補完設定
"   s 検索エンジン+キーワードURL
"   S サジェストエンジン
"   l ロケーションバーの補完機能を利用
"   b ブックマーク
set complete=sSlb

" サーチエンジンの設定
" set defsearch=google

" サジェストエンジンの設定
" set suggestengines=google

" コマンド入力時にコマンド名を自動補完
set wildmode="list:full"

" コマンド履歴の保存数 (default: 500)
set history=500

" 表示されるメッセージの種類を設定 (最大値=15)
set verbose=15

" ']]'や'[['で探す候補に日本人として日本語を追加。
" set nextpattern=^次(へ|の|ペ),^続き,\bnext\b,^>$,^(>>|&#187;)$,^(>|&#187;),(>|&#187;)$,\bmore\b
" set previouspattern=^前(へ|の|ペ),^戻る,\bprev|previous\b,^<$,^(<<|&#171;)$,^(<|&#171;),(<|&#171;)$
set nextpattern=^次$,^次(へ|の|ペ),^続き,^＞$,\bnext,^>$,^(>>|»)$,^(>|»),(>|»)$,\bmore\b
set previouspattern=^前$,^前(へ|の|ペ),^戻る,^＜$,\bprev|previous\b,^<$,^(<<|«)$,^(<|«),(<|«)$

" コマンドラインモード時に自動でimeをOFFにする
style -name commandline-ime chrome://* #liberator-commandline-command input {ime-mode: inactive;}


" Firefox about:config {{{1
"
" キャッシュの設定
"
" ディスクキャッシュを使用しない
set! browser.cache.disk.enable=false
set! browser.cache.disk_cache_ssl=false
" メモリキャッシュを使用する
set! browser.cache.memory.enable=true
" キャッシュメモリの容量(KB)
set! browser.cache.memory.capacity=65536
" キャッシュされるデータの最大サイズ(KB)
set! browser.cache.memory.max_entry_size=10240
" 戻る・進む機能の最大保存履歴数
set! browser.sessionhistory.max_total_viewers=3

" HTTP接続設定
"
" 接続数の上限
set! network.http.max-connections=64
" 1サーバ毎の接続数の上限
" set! network.http.max-connections-per-server=8
" 1プロキシ毎の持続的接続数の上限
set! network.http.max-persistent-connections-per-proxy=4
" 1サーバ毎の持続的接続数の上限
set! network.http.max-persistent-connections-per-server=4 
" IPv6用のDNSリクエストを無効
set! network.dns.disableIPv6=true
" リンク先の先読みを無効
set! network.prefetch-next=false

" パイプライン設定
"
" 非プロキシ接続の時、パイプライン処理をさせる
set! network.http.pipelining=true
" 通信のうちの最初の要求でパイプライン処理を使うか
set! network.http.pipelining.firstrequest=false
" 一度のパイプライン処理で送信する最大要求数
set! network.http.pipelining.maxrequests=8
" SSL接続の時、パイプライン処理をさせる
set! network.http.pipelining.ssl=true
" プロキシ接続の時、パイプライン処理をさせる
set! network.http.proxy.pipelining=true

" レンダリング設定 (高速化)
"
" ページをレンダリングする前の待ち時間
set! nglayout.initialpaint.delay=100
" ページのレンダリング中の基準時間の有効化(?)
set! content.notify.ontimer=true
" content.notify.backoffcountで決めた初期量の時間の間隔(?)
set! content.notify.interval=100000
" ページの大まかなレイアウトの計算がすんだ時に、基準時間でのレンダリングが始まるまでのページの再処理時間(?)
set! content.notify.backoffcount=5

" UI関連
"
" 言語設定
set! general.useragent.locale="ja-JP"
" 全画面表示のアニメーションを無効
set! browser.fullscreen.animateUp=0
" 全画面表示でのツールバー自動非表示を無効
set! browser.fullscreen.autohide=false
" タブ開閉のアニメーションを無効
set! browser.tabs.animate=false
" タブの閉じるボタンの表示形式 
set! browser.tabs.closeButtons=2
" タブグループのアニメーションを無効
set! browser.panorama.animate_zoom=false
" ツールチップを無効にする
" set! browser.chrome.toolbar_tips=false
" Ctrl+Tabでのタブプレビューを有効化
" set! browser.ctrlTab.previews=true
" 右クリックを禁止させない
" set! dom.event.contextmenu.enabled=false
" set! nglayout.events.dispatchLeftClickOnly=true
" フレームの強制リサイズを可能にする
set! layout.frames.force_resizability=true
" about:pluginsでプラグインの完全な位置を示します
set! plugin.expose_full_path=true
" アドオンインストール時の待機時間
set! security.dialog_enable_delay=0
" サブメニュー表示までの待機時間
set! ui.submenuDelay=0
" ソース表示時に右端を折り返す
set! view_source.wrap_long_lines=true
" ドメインハイライト機能を無効にする
set! browser.urlbar.formatting.enabled=false
" ロケーションバーに「http:"」を表示
set! browser.urlbar.trimURLs=false
" 検索結果を新しいタブで表示
set! browser.search.openintab=true

" その他
"
" サイトの自動更新を無効にする
set! accessibility.blockautorefresh=false
" テキストの点滅を無効にする
set! browser.blink_allowed=false
" 文字のスクロール表示を無効にする
set! browser.display.enable_marquee=false
" gifのアニメーションを1回だけにする
" set! image.animation_mode="once"
" ダウンロード後のウイルススキャンを無効にする
set! browser.download.manager.scanWhenDone=false
" ダウンロード完了時のポップアップを無効にする
set! browser.download.manager.showAlertOnComplete=false
" ダウンロード完了時のダウンロードマネージャウィンドウ表示を無効にする
set! browser.download.manager.showWhenStarting=false
" 最小化時のメモリ使用量を抑える
set! config.trim_on_minimize=true
" 位置検出情報を無効にする
set! geo.enabled=false
" Hello無効化
set! loop.enabled=false

" Enable E10S
set! browser.tabs.remote.autostart=true
set! browser.tabs.remote.force-enable=true


" カラー設定 {{{1
"
" colorscheme mytheme
colorscheme jellybeans


" プラグイン毎の設定 {{{1
"
" imekeys.js
" コマンドラインで自動的にオフ
let g:imeoff='cmd'

" toggler.js
js <<EOM
liberator.globalVariables.toggler = {
  toolbars: ["set toolbars=none,tabs", "set toolbars=all"],
  //...
};
EOM


" ユーザー定義コマンド {{{1
"
command! reloadrc :source ~/.vimperatorrc

" プライベートタブ切り替え
js <<EOM
function toggle_private_tab()
{
  flg = privateTab.isTabPrivate(gBrowser.mCurrentTab);
  privateTab.toggleTabPrivate(gBrowser.mCurrentTab, !flg);
}
EOM
command! toggleprivate javascript toggle_private_tab()

" MyBookmarks
command! mybookmarks :open about:mybookmarks

" Add to Pocket
js <<EOM
function add_pocket()
{
  let doc = gBrowser.selectedBrowser.contentDocument;
  Pocket.savePage(gBrowser, doc.URL, doc.title);
  liberator.echo("saved: " + doc.title);
}
EOM
command! -description "add to pocket" pocket javascript add_pocket()

" Evernote Web Clipperを起動
" command! clip javascript evernote_doAction()


" キーマッピング {{{1
"
mapclear

" LEADERの変更 「\」は遠いので「,」にする
let mapleader=","

" 移動
nnoremap j <Down>
nnoremap k <Up>
nnoremap <C-e> <C-d>
nnoremap <C-y> <C-u>
nnoremap <C-f> <PageDown>
nnoremap <C-b> <PageUp>

" 左右移動
nnoremap <S-j> <Right>
nnoremap <S-k> <Left>

" 戻ると進む
nnoremap b     <A-Left>
nnoremap <S-b> <A-Right>

" タブ移動
nnoremap h gT
nnoremap l gt

" タブ位置変更
nnoremap <S-h> :tabmove -1<CR> 
nnoremap <S-l> :tabmove +1<CR> 

" 最初の入力フィールドへ移動
nnoremap i gi

" Ctrl+cでも選択文字列のコピーが出来るようにする
nnoremap <C-c> Y

" 検索結果のハイライトをEsc連打でリセットする
nnoremap <silent> <Esc><Esc> :nohlsearch<CR>

" All in one sidebarのトグル
nnoremap s <F4>

" ツールバーのトグル
nnoremap x :toggle toolbars<CR>

" コマンドラインでのカーソル移動
cnoremap <C-n> <TAB>
cnoremap <C-p> <S-TAB>
 
" 右手だけで操作するための設定
nnoremap <LEADER>j f
nnoremap <LEADER>m <S-f>
nnoremap <LEADER>k d
nnoremap <LEADER>h <A-Left>
nnoremap <LEADER>l <A-Right>

" ブックマークダイアログ表示
nnoremap <LEADER>a :dialog addbookmark<CR>

" プライベートブラウジング
nnoremap <LEADER>p :toggleprivate<CR>
nnoremap <LEADER>P :winopen -private<CR>

" vimperatorrc再読み込み
nnoremap <LEADER>r :reloadrc<CR>

" emacsキーバインド (インサートモード)
inoremap <C-p> <Up>
inoremap <C-n> <Down>
inoremap <C-b> <Left>
inoremap <C-f> <Right>
inoremap <C-e> <End>
inoremap <C-a> <Home>
inoremap <C-h> <BS>
inoremap <C-d> <Del>

" emacsキーバインド (コマンドモード)
cnoremap <C-b> <Left>
cnoremap <C-f> <Right>
cnoremap <C-e> <End>
cnoremap <C-a> <Home>
cnoremap <C-h> <BS>
cnoremap <C-d> <Del>

" disable keys
nnoremap <C-w> <Nop>
nnoremap <S-Esc> <Nop>
cnoremap <S-Esc> <Nop>
inoremap <S-Esc> <Nop>

" ブックマークツールバーをファビコンのみ表示する
style -name bookmark-toolbar chrome://* <<EOM
@namespace url("http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul");
toolbarbutton.bookmark-item > .toolbarbutton-text {
  display: none !important;
}
EOM

" 読み込み完了のメッセージ表示
echo 'vimperatorrc loaded'


" {{{1
" vim:set expandtab ft=vim ts=2 sts=2 sw=2 foldmethod=marker:
